{"ast":null,"code":"var os = require('os');\nvar util = require('util');\nvar _ = require('lodash');\nvar Promise = require('bluebird');\nvar _constants = require('./constants');\nvar _utils = require('./utils');\nvar getCrumb = require('./yahooCrumb').getCrumb;\nvar validModules = ['summaryProfile', 'financialData', 'recommendationTrend', 'upgradeDowngradeHistory', 'earnings', 'price', 'summaryDetail', 'defaultKeyStatistics', 'calendarEvents'];\nvar dateFields = {\n  summaryDetail: ['exDividendDate'],\n  calendarEvents: ['exDividendDate', 'dividendDate'],\n  upgradeDowngradeHistory: ['history.epochGradeDate'],\n  price: ['preMarketTime', 'postMarketTime', 'regularMarketTime'],\n  defaultKeyStatistics: ['lastFiscalYearEnd', 'nextFiscalYearEnd', 'mostRecentQuarter', 'lastSplitDate']\n};\nfunction _sanitizeQuoteOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n  if (options.modules) {\n    if (!_.isArray(options.modules)) throw new Error('\"options.modules\" must be a non-empty string array or undefined.');\n  } else {\n    options.modules = ['price', 'summaryDetail'];\n  }\n  var invalid = _.difference(options.modules, validModules);\n  if (invalid.length) {\n    var available = _.difference(validModules, options.modules);\n    throw new Error(\"[yahoo-finance] quote(): The following requested \" + \"modules do not exist: \" + JSON.stringify(invalid) + \".  Did you mean one of: \" + JSON.stringify(available) + \"?\");\n  }\n}\nfunction transformDates(result) {\n  _.each(_.keys(result), function (module) {\n    _.each(dateFields[module], function (field) {\n      if (field.indexOf('.') === -1) {\n        if (result[module][field]) result[module][field] = new Date(result[module][field] * 1000);\n      } else {\n        var parts = field.split('.');\n        var arrayName = parts[0];\n        var subField = parts[1];\n        if (result[module][arrayName]) _.each(result[module][arrayName], function (row) {\n          if (row[subField]) row[subField] = new Date(row[subField] * 1000);\n        });\n      }\n    });\n  });\n  return result;\n}\nfunction quote(options, optionalHttpRequestOptions, cb) {\n  if (_.isString(options)) {\n    options = {\n      symbol: options\n    };\n    if (_.isArray(optionalHttpRequestOptions)) {\n      options.modules = optionalHttpRequestOptions;\n      optionalHttpRequestOptions = undefined;\n    }\n  }\n  var symbols = options.symbols || _.flatten([options.symbol]);\n  options = _.clone(options);\n  _sanitizeQuoteOptions(options);\n  if (optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n  optionalHttpRequestOptions.json = true;\n  return getCrumb(symbols[0]).then(function (crumb) {\n    return Promise.map(symbols, function (symbol) {\n      var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n      return _utils.download(url, {\n        formatted: 'false',\n        crumb: crumb,\n        modules: options.modules.join(','),\n        corsDomain: 'finance.yahoo.com'\n      }, optionalHttpRequestOptions).then(function (result) {\n        var quoteSummary = result.quoteSummary;\n        if (!quoteSummary || quoteSummary.error) throw new Error(quoteSummary.error);\n        var result = quoteSummary.result;\n        if (!_.isArray(result) || result.length > 1) throw new Error(\"quoteSummary format has changed, please report \" + \"this.\");\n        return result[0];\n      }).then(transformDates);\n    }, {\n      concurrency: options.maxConcurrentSymbols || os.cpus().length\n    }).then(function (results) {\n      if (options.symbols) {\n        return _.zipObject(symbols, results);\n      } else {\n        return results[0];\n      }\n    }).catch(function (err) {\n      throw new Error(util.format('Failed to download data (%s)', err.message));\n    }).nodeify(cb);\n  });\n}\n\n// API (ES6 syntax with default export)\nexports.__esModule = true;\nexports.default = quote;\n\n// Used by snapshot\nexports.dateFields = dateFields;\n\n// For tests\nexports._sanitizeQuoteOptions = _sanitizeQuoteOptions;","map":{"version":3,"names":["os","require","util","_","Promise","_constants","_utils","getCrumb","validModules","dateFields","summaryDetail","calendarEvents","upgradeDowngradeHistory","price","defaultKeyStatistics","_sanitizeQuoteOptions","options","isPlainObject","Error","isUndefined","symbol","symbols","isString","isEmpty","isArray","modules","invalid","difference","length","available","JSON","stringify","transformDates","result","each","keys","module","field","indexOf","Date","parts","split","arrayName","subField","row","quote","optionalHttpRequestOptions","cb","undefined","flatten","clone","json","then","crumb","map","url","SNAPSHOT_URL","replace","download","formatted","join","corsDomain","quoteSummary","error","concurrency","maxConcurrentSymbols","cpus","results","zipObject","catch","err","format","message","nodeify","exports","__esModule","default"],"sources":["/Users/lordvoldemort/IdeaProjects/Webdevelopment/Bulls and Bears/bull_bear/node_modules/yahoo-finance/lib/quote.js"],"sourcesContent":["var os = require('os');\nvar util = require('util');\n\nvar _ = require('lodash');\nvar Promise = require('bluebird');\n\nvar _constants = require('./constants');\nvar _utils = require('./utils');\nvar getCrumb = require('./yahooCrumb').getCrumb;\n\nvar validModules = [\n  'summaryProfile', 'financialData', 'recommendationTrend',\n  'upgradeDowngradeHistory', 'earnings', 'price', 'summaryDetail',\n  'defaultKeyStatistics', 'calendarEvents'\n];\n\nvar dateFields = {\n  summaryDetail: [ 'exDividendDate' ],\n  calendarEvents: [ 'exDividendDate', 'dividendDate' ],\n  upgradeDowngradeHistory: [ 'history.epochGradeDate' ],\n  price: [ 'preMarketTime', 'postMarketTime', 'regularMarketTime' ],\n  defaultKeyStatistics: [\n    'lastFiscalYearEnd', 'nextFiscalYearEnd',\n    'mostRecentQuarter', 'lastSplitDate'\n  ]\n};\n\nfunction _sanitizeQuoteOptions(options) {\n  if (!_.isPlainObject(options)) {\n    throw new Error('\"options\" must be a plain object.');\n  }\n  if (_.isUndefined(options.symbol) && _.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be defined.');\n  }\n  if (!_.isUndefined(options.symbol) && !_.isUndefined(options.symbols)) {\n    throw new Error('Either \"options.symbol\" or \"options.symbols\" must be undefined.');\n  }\n\n  if (!_.isUndefined(options.symbol)) {\n    if (!_.isString(options.symbol) || _.isEmpty(options.symbol)) {\n      throw new Error('\"options.symbol\" must be a non-empty string.');\n    }\n  } else {\n    if (!_.isArray(options.symbols) || _.isEmpty(options.symbols)) {\n      throw new Error('\"options.symbols\" must be a non-empty string array.');\n    }\n  }\n\n  if (options.modules) {\n    if (!_.isArray(options.modules))\n      throw new Error('\"options.modules\" must be a non-empty string array or undefined.');\n  } else {\n    options.modules = ['price', 'summaryDetail'];\n  }\n\n  var invalid = _.difference(options.modules, validModules);\n  if (invalid.length) {\n    var available = _.difference(validModules, options.modules);\n    throw new Error(\"[yahoo-finance] quote(): The following requested \" +\n      \"modules do not exist: \" + JSON.stringify(invalid) +\n      \".  Did you mean one of: \" + JSON.stringify(available) + \"?\");\n  }\n}\n\nfunction transformDates(result) {\n  _.each(_.keys(result), function(module) {\n    _.each(dateFields[module], function(field) {\n\n      if (field.indexOf('.') === -1) {\n\n        if (result[module][field])\n          result[module][field] = new Date(result[module][field] * 1000);\n\n      } else {\n\n        var parts = field.split('.');\n        var arrayName = parts[0];\n        var subField = parts[1];\n\n        if (result[module][arrayName])\n        _.each(result[module][arrayName], function(row) {\n          if (row[subField])\n            row[subField] = new Date(row[subField] * 1000);\n        });\n\n      }\n    });\n  });\n  return result;\n}\n\nfunction quote(options, optionalHttpRequestOptions, cb) {\n  if (_.isString(options)) {\n    options = { symbol: options };\n    if (_.isArray(optionalHttpRequestOptions)) {\n      options.modules = optionalHttpRequestOptions;\n      optionalHttpRequestOptions = undefined;\n    }\n  }\n\n  var symbols = options.symbols || _.flatten([options.symbol]);\n  options = _.clone(options);\n  _sanitizeQuoteOptions(options);\n\n  if(optionalHttpRequestOptions && typeof optionalHttpRequestOptions == 'function') {\n    cb = optionalHttpRequestOptions;\n    optionalHttpRequestOptions = {};\n  } else if (!optionalHttpRequestOptions) {\n    optionalHttpRequestOptions = {};\n  }\n\n  optionalHttpRequestOptions.json = true;\n\n  return getCrumb(symbols[0])\n    .then(function(crumb) {\n      return Promise.map(symbols, function (symbol) {\n        var url = _constants.SNAPSHOT_URL.replace(/\\$SYMBOL/, symbol);\n        return _utils.download(url, {\n            formatted: 'false',\n            crumb: crumb,\n            modules: options.modules.join(','),\n            corsDomain: 'finance.yahoo.com'\n          }, optionalHttpRequestOptions)\n          .then(function(result) {\n            var quoteSummary = result.quoteSummary;\n            if (!quoteSummary || quoteSummary.error)\n              throw new Error(quoteSummary.error);\n\n            var result = quoteSummary.result;\n            if (!_.isArray(result) || result.length > 1)\n              throw new Error(\"quoteSummary format has changed, please report \"\n                + \"this.\");\n\n            return result[0];\n          })\n          .then(transformDates)\n      }, {concurrency: options.maxConcurrentSymbols || os.cpus().length})\n      .then(function (results) {\n        if (options.symbols) {\n          return _.zipObject(symbols, results);\n        } else {\n          return results[0];\n        }\n      })\n      .catch(function (err) {\n        throw new Error(util.format('Failed to download data (%s)', err.message));\n      })\n      .nodeify(cb);\n    });\n}\n\n// API (ES6 syntax with default export)\nexports.__esModule = true;\nexports.default = quote;\n\n// Used by snapshot\nexports.dateFields = dateFields;\n\n// For tests\nexports._sanitizeQuoteOptions = _sanitizeQuoteOptions;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}